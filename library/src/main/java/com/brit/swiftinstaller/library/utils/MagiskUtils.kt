@file:Suppress("MemberVisibilityCanBePrivate")

package com.brit.swiftinstaller.library.utils

import com.topjohnwu.superuser.io.SuFile

object MagiskUtils {

    const val MAGISK_PATH = "/sbin/.magisk/img"
    const val MAGISK_MODULE_PATH = "$MAGISK_PATH/swift_installer"
    const val MAGISk_MODULE_VERSION = 4


    @Suppress("UNUSED_PARAMETER")
    fun createModule() {
        if (!SuFile("$MAGISK_MODULE_PATH/$MAGISk_MODULE_VERSION").exists())
        {
            runCommand("mkdir -p $MAGISK_MODULE_PATH", true)
            runCommand("chmod -R 755 $MAGISK_MODULE_PATH", true)
            runCommand("touch $MAGISK_MODULE_PATH/auto_mount", true)
            runCommand("touch $MAGISK_MODULE_PATH/update", true)
            runCommand("touch $MAGISK_MODULE_PATH/$MAGISk_MODULE_VERSION", true)
            var moduleProp = "id=swift_installer\n"
            moduleProp += "name=Swift Installer Module\n"
            moduleProp += "version=v$MAGISk_MODULE_VERSION\n"
            moduleProp += "versionCode=$MAGISk_MODULE_VERSION\n"
            moduleProp += "author=Swift Team\n"
            moduleProp += "description=Generated By Swift Installer\n"
            runCommand("echo \"$moduleProp\" > $MAGISK_MODULE_PATH/module.prop", true)
        }
    }

    val magiskEnabled = !SuFile(MAGISK_MODULE_PATH, "disable").exists()
            && SuFile(MAGISK_PATH).exists()
}
